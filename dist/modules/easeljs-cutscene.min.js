/*! SpringRoll 0.4.22 */
!function(){"use strict";!function(){function a(a,b){return a.start-b.start}var b,c,d,e,f=include("createjs.Container"),g=function(g){if(d||(b=include("springroll.Debug",!1),d=include("springroll.Application"),e=include("springroll.Sound"),c=include("springroll.easeljs.BitmapUtils")),f.call(this),!g)throw"Need options to create Cutscene";var h=this._display=g.display;this.width=g.width,this.height=g.height,this._elapsedTime=0,this._audio=g.audio?g.audio.slice():[],this._audio.sort(a),this._audioIndex=0;var i=this._clip=g.clip;this._activeSyncAudio=[],this._soundStartTime=-1,this._activeAudio=[],this._audioFinished=!1,this._endCallback=null;var j=this._captions=g.captions;j&&(j.selfUpdate=!1),this.update=this.update.bind(this),this.resize=this.resize.bind(this),i.mouseEnabled=!1,i.tickEnabled=!1,i.gotoAndPlay(0),i.loop=!1,this.addChild(i),this.resize(h.width,h.height),d.instance.on("resize",this.resize)},h=extend(g,f);h.resize=function(a,b){if(this._clip){var c,d=this.width/this.height,e=a/b;d>e?(c=a/this.width,this.x=0,this.y=.5*(b-this.height*c)):(c=b/this.height,this.x=.5*(a-this.width*c),this.y=0),this._clip.scaleX=this._clip.scaleY=c}},h.start=function(a){this._endCallback=a,this._elapsedTime=0,this._animFinished=!1,this._audioFinished=!this._audio.length;for(var b=0;b<this._audio.length;++b){var c=this._audio[b];if(0!==c.start)break;var f=c.alias,g={};if(c.sync){var h=e.instance.play(f,this._audioCallback.bind(this,g));this._activeSyncAudio.unshift(h),g.instance=h,h._audioData=c,this._soundStartTime=c.start,this._captions&&this._captions.play(f)}else{var i=e.instance.play(f,this._audioCallback.bind(this,g));g.instance=i,this._activeAudio.push(i)}++this._audioIndex}d.instance.on("update",this.update)},h._audioCallback=function(a){var b=this._activeSyncAudio.indexOf(a.instance);if(-1!=b)if(0===b?this._activeSyncAudio.shift():this._activeSyncAudio.splice(b,1),this._activeSyncAudio.length<1)this._audioFinished=!0,this._soundStartTime=-1,this._captions&&this._captions.stop(),this._animFinished&&this.stop(!0);else{var c=this._activeSyncAudio[0]._audioData;this._soundStartTime=c.start,this._captions&&this._captions.play(c.alias)}else b=this._activeAudio.indexOf(a.instance),-1!=b&&this._activeAudio.splice(b,1)},h.update=function(a){if(!this._animFinished){this._activeSyncAudio.length||(this._elapsedTime+=.001*a);for(var b=this._audioIndex;b<this._audio.length;++b){var c=this._audio[b];if(!(c.start<=this._elapsedTime))break;var d=c.alias,f={};if(c.sync){this._audioFinished=!1;var g=e.instance.play(d,this._audioCallback.bind(this,f));this._activeSyncAudio.unshift(g),f.instance=g,g._audioData=c,this._elapsedTime=this._soundStartTime=c.start,this._captions&&this._captions.play(d)}else{var h=e.instance.play(d,{complete:this._audioCallback.bind(this,f),offset:1e3*(this._elapsedTime-c.start)});f.instance=h,this._activeAudio.push(h)}++this._audioIndex}if(this._activeSyncAudio.length){var i=.001*this._activeSyncAudio[0].position;0===this._elapsedTime&&i>2*a||(this._elapsedTime=this._soundStartTime+i)}if(this._captions&&this._soundStartTime>=0&&this._captions.seek(this._activeSyncAudio[0].position),!this._animFinished){var j=this._clip.timeline&&1!=this._clip.timeline.duration?this._clip:this._clip.getChildAt(0);j.elapsedTime=this._elapsedTime,j.advance(),j.currentFrame==j.timeline.duration&&(this._animFinished=!0,this._audioFinished&&this.stop(!0))}}},h.stop=function(a){d.instance.off("update",this.update);var b;for(b=0;b<this._activeSyncAudio.length;++b)this._activeSyncAudio[b].stop();for(b=0;b<this._activeAudio.length;++b)this._activeAudio[b].stop();this._activeAudio.length=this._activeSyncAudio.length=0,this._captions&&this._captions.stop(),a&&(this.dispatchEvent("complete"),this._endCallback&&(this._endCallback(),this._endCallback=null))},h.destroy=function(){this.stop(),this.dispatchEvent("destroy"),d.instance.off("resize",this.resize),this.removeAllChildren(!0),this._activeSyncAudio=this._activeAudio=this._audio=this._display=this._endCallback=this._clip=this._captions=null,this.parent&&this.parent.removeChild(this),this.removeAllEventListeners()},namespace("springroll").Cutscene=g,namespace("springroll.easeljs").Cutscene=g}(),function(a){var b=include("springroll.Task"),c=include("springroll.easeljs.Cutscene"),d=include("springroll.Application"),e=function(a){b.call(this,a,a.animClass);var c=d.instance;this.anim=a.anim,this.fps=a.fps||c.options.fps,this.animClass=a.animClass,this.width=a.width,this.height=a.height,this.audio=a.audio,this.images=a.images,this.libName=a.libName||"lib",this.imagesName=a.imagesName||"images",this.display="string"==typeof a.display?c.getDisplay(a.display):c.display},f=b.prototype,g=b.extend(e);e.test=function(a){return!!a.anim&&a.anim.search(/\.js$/i)>-1&&!!a.animClass&&a.width&&a.height},g.start=function(a){var b={_anim:{src:this.anim,libName:this.libName,images:this.images,imagesName:this.imagesName,type:"easeljs",format:"springroll.easeljs.FlashArt"}};if(this.audio){var e=[];this.audio.forEach(function(a){e.push(a.alias)}),b._audio={sounds:e}}var f=d.instance;f.load(b,function(b){var d=include(this.libName+"."+this.animClass),e=new d;e.framerate=this.fps;var g=new c({clip:e,width:this.width,height:this.height,display:this.display,captions:f.captions||null,audio:this.audio});g.addEventListener("destroy",function(){b._anim.destroy(),b._audio&&b._audio.destroy()}),a(g)}.bind(this))},g.destroy=function(){this.display=null,this.images=null,this.audio=null,f.destroy.call(this)},namespace("springroll.easeljs").CutsceneTask=e}(window),function(){var a=include("springroll.ApplicationPlugin"),b=new a;b.setup=function(){this.assetManager.register("springroll.easeljs.CutsceneTask",80)}}();}();